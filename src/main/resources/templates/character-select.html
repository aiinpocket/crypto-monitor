<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-Hant">
<head th:replace="~{fragments/head :: head('BtcTrade - 選擇你的職業')}"></head>
<body class="bg-bg-dark text-text-main min-h-screen flex items-center justify-center relative overflow-hidden">

    <!-- 像素星空背景 -->
    <div class="absolute inset-0 opacity-30"
         style="background: radial-gradient(1px 1px at 10% 20%, #e2b714 1px, transparent 0),
                            radial-gradient(1px 1px at 30% 50%, #a855f7 1px, transparent 0),
                            radial-gradient(1px 1px at 50% 10%, #e2b714 1px, transparent 0),
                            radial-gradient(1px 1px at 70% 40%, #38bdf8 1px, transparent 0),
                            radial-gradient(1px 1px at 90% 70%, #e2b714 1px, transparent 0),
                            radial-gradient(1px 1px at 15% 80%, #a855f7 1px, transparent 0),
                            radial-gradient(1px 1px at 45% 65%, #38bdf8 1px, transparent 0),
                            radial-gradient(1px 1px at 80% 15%, #e2b714 1px, transparent 0);"></div>

    <div class="w-full max-w-4xl px-4 md:px-6 relative z-10" x-data="characterSelect()">
        <!-- 標題 -->
        <div class="text-center mb-6 md:mb-8">
            <div class="text-4xl mb-3 anim-sparkle inline-block">&#9876;</div>
            <h1 class="font-heading text-lg md:text-xl text-primary glow-gold">選擇你的職業</h1>
            <p class="text-text-muted text-sm mt-2">每個職業擁有不同的交易策略風格，請慎重選擇！</p>
            <p class="text-text-muted text-xs mt-1">（之後可在設定頁面更換職業）</p>
        </div>

        <!-- 四職業選項 -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-6">
            <template x-for="cls in classes" :key="cls.key">
                <button @click="selected = cls.key"
                        class="pixel-card p-4 md:p-5 text-center cursor-pointer transition-all duration-150 relative"
                        :class="selected === cls.key
                            ? 'ring-2 ring-primary brightness-110 scale-[1.02]'
                            : 'hover:bg-white/5 hover:scale-[1.01]'">
                    <!-- 選中標記 -->
                    <div x-show="selected === cls.key" class="absolute top-2 right-2 text-primary text-sm">&#10003;</div>

                    <!-- 像素角色 -->
                    <div class="flex justify-center mb-3">
                        <div class="relative w-[48px] h-[48px]">
                            <div class="absolute top-0 left-0 anim-idle" :class="'pixel-char-' + cls.key.toLowerCase()"></div>
                        </div>
                    </div>

                    <!-- 職業名稱 -->
                    <div class="font-heading text-sm mb-1"
                         :class="selected === cls.key ? 'text-primary' : 'text-text-heading'"
                         x-text="cls.icon + ' ' + cls.name"></div>

                    <!-- 策略風格 -->
                    <div class="text-xs text-cta mb-2" x-text="cls.style"></div>

                    <!-- 策略數據 -->
                    <div class="space-y-1 text-[10px] text-text-muted">
                        <div class="flex justify-between px-2">
                            <span>年化報酬</span>
                            <span class="text-positive" x-text="cls.annualReturn"></span>
                        </div>
                        <div class="flex justify-between px-2">
                            <span>最大回撤</span>
                            <span class="text-negative" x-text="cls.maxDD"></span>
                        </div>
                        <div class="flex justify-between px-2">
                            <span>Sharpe</span>
                            <span class="text-primary" x-text="cls.sharpe"></span>
                        </div>
                    </div>

                    <!-- 描述 -->
                    <div class="text-[11px] text-text-muted mt-3 leading-relaxed" x-text="cls.desc"></div>
                </button>
            </template>
        </div>

        <!-- 確認按鈕 -->
        <div class="text-center">
            <button @click="confirm()"
                    :disabled="!selected || submitting"
                    class="pixel-btn pixel-btn-gold text-sm py-3 px-10 cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed">
                <span x-show="!submitting" x-text="selected ? '以「' + getClassName(selected) + '」身份踏上冒險！' : '請選擇一個職業'"></span>
                <span x-show="submitting" class="anim-flash">建立角色中...</span>
            </button>
            <div x-show="error" class="text-xs text-negative mt-3" x-text="error"></div>
        </div>
    </div>

<script>
function characterSelect() {
    return {
        selected: null,
        submitting: false,
        error: '',
        classes: [
            {
                key: 'WARRIOR', icon: '\u2694\uFE0F', name: '\u6230\u58EB',
                style: '\u653B\u5B88\u517C\u5099 \u2022 \u5E73\u8861\u578B',
                annualReturn: '+31.2%', maxDD: '-38.9%', sharpe: '1.79',
                desc: '4% \u505C\u640D + \u6975\u7DCA\u79FB\u52D5\u505C\u5229\uFF0C80% \u5009\u4F4D\u63A7\u5236\u98A8\u96AA\u3002\u517C\u9867\u52DD\u7387\u8207\u5831\u916C\uFF0C\u9069\u5408\u591A\u6578\u5E02\u5834\u74B0\u5883\u3002'
            },
            {
                key: 'MAGE', icon: '\uD83D\uDD2E', name: '\u6CD5\u5E2B',
                style: '\u8DA8\u52E2\u8DDF\u8E64 \u2022 \u9AD8\u98A8\u96AA\u9AD8\u5831\u916C',
                annualReturn: '+54.4%', maxDD: '-55.6%', sharpe: '3.14',
                desc: '5% \u5BEC\u505C\u640D + 10 \u5929\u9577\u6301\u5009\uFF0C\u5168\u5009\u8FFD\u8E64\u5927\u6CE2\u6BB5\u3002\u5E74\u5316 54%+ \u4F46\u9700\u627F\u53D7\u9AD8\u56DE\u64A4\u3002'
            },
            {
                key: 'RANGER', icon: '\uD83C\uDFF9', name: '\u904A\u4FE0',
                style: '\u7A69\u5065\u9632\u5B88 \u2022 \u4FDD\u5B88\u578B',
                annualReturn: '+27.8%', maxDD: '-26.0%', sharpe: '3.62',
                desc: '40% \u5009\u4F4D + \u5BEC RSI \u904E\u6FFE\uFF0C\u8FFD\u6C42\u6700\u4F4E\u56DE\u64A4\u8207\u6700\u9AD8 Sharpe\u3002\u9069\u5408\u4FDD\u5B88\u578B\u4EA4\u6613\u8005\u3002'
            },
            {
                key: 'ASSASSIN', icon: '\uD83D\uDDE1\uFE0F', name: '\u523A\u5BA2',
                style: '\u77ED\u7DDA\u7206\u767C \u2022 \u901F\u6230\u901F\u6C7A',
                annualReturn: '+44.6%', maxDD: '-54.4%', sharpe: '2.11',
                desc: '\u5FEB\u901F EMA(8/21) + 3% \u7DCA\u505C\u640D + 2 \u5929\u901F\u6230\u3002\u4EA4\u6613\u983B\u7387\u6700\u9AD8\uFF0C\u9069\u5408\u6D3B\u8E8D\u5E02\u5834\u3002'
            }
        ],

        getClassName(key) {
            const cls = this.classes.find(c => c.key === key);
            return cls ? cls.name : '';
        },

        async confirm() {
            if (!this.selected) return;
            this.submitting = true;
            this.error = '';
            try {
                const resp = await fetch('/api/user/character-select', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ characterClass: this.selected })
                });
                if (resp.ok) {
                    window.location.href = '/';
                } else {
                    const data = await resp.json();
                    this.error = data.error || '\u5EFA\u7ACB\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66';
                }
            } catch (e) {
                this.error = '\u7DB2\u8DEF\u932F\u8AA4\uFF0C\u8ACB\u91CD\u8A66';
            } finally {
                this.submitting = false;
            }
        }
    };
}
</script>

</body>
</html>
