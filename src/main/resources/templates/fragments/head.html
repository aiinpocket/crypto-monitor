<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:fragment="head(title)">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">BtcTrade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#e2b714',
                        'primary-hover': '#c9a012',
                        secondary: '#FBBF24',
                        cta: '#a855f7',
                        'cta-hover': '#9333ea',
                        'bg-dark': '#1a1a2e',
                        'bg-card': '#16213e',
                        'bg-input': '#0f0f23',
                        'border-main': '#2a2a4a',
                        'text-main': '#e8e8f0',
                        'text-muted': '#9090b8',
                        'text-heading': '#d0d0e8',
                        positive: '#4ade80',
                        negative: '#ef4444',
                        warning: '#e2b714',
                        'pixel-gold': '#e2b714',
                        'pixel-purple': '#a855f7',
                        'pixel-blue': '#38bdf8',
                        'pixel-dark': '#0f0f23',
                    },
                    fontFamily: {
                        heading: ['"Press Start 2P"', 'monospace'],
                        body: ['"Exo 2"', 'sans-serif'],
                        mono: ['"Exo 2"', 'monospace'],
                    }
                }
            }
        }
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.9/dist/cdn.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* 防止頁面切換閃爍（FOUC）：初始隱藏，Tailwind 處理完後顯示 */
        body { font-family: 'Exo 2', sans-serif; font-size: 14px; image-rendering: pixelated; opacity: 0; transition: opacity 0.12s ease-in; }
        body.page-ready { opacity: 1; }
        [x-cloak] { display: none !important; }
        * { image-rendering: pixelated; }
        .font-heading { font-family: 'Press Start 2P', monospace; }

        /* ===== 像素邊框系統 ===== */
        .pixel-border {
            border: 3px solid #e2b714;
            border-image: none;
            box-shadow:
                inset -2px -2px 0 0 #8a6d0a,
                inset 2px 2px 0 0 #ffd642;
        }
        .pixel-border-purple {
            border: 3px solid #a855f7;
            box-shadow:
                inset -2px -2px 0 0 #6b21a8,
                inset 2px 2px 0 0 #c084fc;
        }
        .pixel-border-dark {
            border: 3px solid #2a2a4a;
            box-shadow:
                inset -2px -2px 0 0 #1a1a2e,
                inset 2px 2px 0 0 #3a3a5a;
        }

        /* ===== 像素按鈕 ===== */
        .pixel-btn {
            border: 3px solid;
            position: relative;
            padding: 8px 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: transform 0.05s;
        }
        .pixel-btn:active {
            transform: translateY(2px);
        }
        .pixel-btn-gold {
            border-color: #e2b714;
            background: linear-gradient(180deg, #ffd642 0%, #e2b714 50%, #8a6d0a 100%);
            color: #1a1a2e;
            box-shadow: 0 4px 0 0 #5a4408, inset 0 1px 0 0 #ffe680;
        }
        .pixel-btn-gold:active { box-shadow: 0 1px 0 0 #5a4408; }
        .pixel-btn-purple {
            border-color: #a855f7;
            background: linear-gradient(180deg, #c084fc 0%, #a855f7 50%, #6b21a8 100%);
            color: #fff;
            box-shadow: 0 4px 0 0 #4a1580, inset 0 1px 0 0 #d8b4fe;
        }
        .pixel-btn-purple:active { box-shadow: 0 1px 0 0 #4a1580; }

        /* ===== 像素卡片 ===== */
        .pixel-card {
            background: #16213e;
            border: 3px solid #2a2a4a;
            box-shadow:
                inset -2px -2px 0 0 #0f0f23,
                inset 2px 2px 0 0 #2a3a5e,
                6px 6px 0 0 rgba(0,0,0,0.4);
        }

        /* ===== 像素 EXP 進度條 ===== */
        .pixel-exp-bar {
            height: 14px;
            border: 2px solid #2a2a4a;
            background: #0f0f23;
            position: relative;
            overflow: hidden;
        }
        .pixel-exp-fill {
            height: 100%;
            background: linear-gradient(180deg, #4ade80 0%, #22c55e 60%, #16a34a 100%);
            box-shadow: inset 0 -2px 0 0 #15803d, inset 0 2px 0 0 #86efac;
            transition: width 0.5s steps(20);
        }
        .pixel-hp-fill {
            height: 100%;
            background: linear-gradient(180deg, #ef4444 0%, #dc2626 60%, #b91c1c 100%);
            box-shadow: inset 0 -2px 0 0 #991b1b, inset 0 2px 0 0 #fca5a5;
        }

        /* ===== 像素心形（同步狀態） ===== */
        .pixel-heart { display: inline-block; width: 10px; height: 10px; position: relative; }
        .pixel-heart::before {
            content: '';
            position: absolute;
            width: 100%; height: 100%;
            background:
                linear-gradient(90deg,
                    transparent 10%, #22c55e 10% 30%, transparent 30% 40%,
                    #22c55e 40% 60%, transparent 60% 70%,
                    #22c55e 70% 90%, transparent 90%);
        }
        .pixel-heart-error::before { background: linear-gradient(90deg, transparent 30%, #ef4444 30% 70%, transparent 70%); }

        /* ===== 遊戲化動畫 ===== */
        @keyframes pixelLevelUp {
            0% { transform: scale(1) translateY(0); opacity: 1; }
            30% { transform: scale(1.5) translateY(-10px); opacity: 1; }
            60% { transform: scale(1.2) translateY(-20px); opacity: 0.8; }
            100% { transform: scale(1) translateY(-40px); opacity: 0; }
        }
        @keyframes pixelBounce {
            0% { transform: translateY(-80px); }
            40% { transform: translateY(0); }
            55% { transform: translateY(-20px); }
            70% { transform: translateY(0); }
            85% { transform: translateY(-8px); }
            100% { transform: translateY(0); }
        }
        @keyframes pixelSlideIn {
            from { transform: translateX(120%); }
            to { transform: translateX(0); }
        }
        @keyframes pixelFlash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        @keyframes pixelSparkle {
            0%, 100% { box-shadow: 0 0 2px #e2b714; }
            50% { box-shadow: 0 0 6px #e2b714; }
        }
        .anim-level-up { animation: pixelLevelUp 1.5s steps(8) forwards; }
        .anim-bounce { animation: pixelBounce 0.8s steps(6) forwards; }
        .anim-slide-in { animation: pixelSlideIn 0.4s steps(4) forwards; }
        .anim-flash { animation: pixelFlash 0.5s steps(2) 3; }
        .anim-sparkle { animation: pixelSparkle 1.5s ease-in-out infinite; }

        /* ===== 像素捲軸 ===== */
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #0f0f23; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #2a2a4a; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #3a3a5a; }

        /* ===== Toast 動畫（像素化） ===== */
        .toast-enter { animation: pixelSlideIn 0.3s steps(4); }
        .toast-exit { animation: pixelSlideIn 0.3s steps(4) reverse forwards; }

        /* ===== 金光文字（硬邊像素陰影，無模糊） ===== */
        .glow-gold { text-shadow: 1px 1px 0 #8a6d0a, -1px -1px 0 rgba(226,183,20,0.15); }
        .glow-purple { text-shadow: 1px 1px 0 #6b21a8, -1px -1px 0 rgba(168,85,247,0.15); }

        /* ===== 像素角色（8x8 grid, 6px/pixel = 48px） ===== */
        .pixel-character { width: 48px; height: 48px; image-rendering: pixelated; }
        /* 戰士 - 金色身體, 藍鋼盾牌, 白銀劍 */
        .pixel-char-warrior {
            width: 6px; height: 6px; background: transparent;
            box-shadow:
                18px 0 0 #ffd642,
                12px 6px 0 #e2b714, 18px 6px 0 #e2b714, 24px 6px 0 #e2b714,
                12px 12px 0 #e2b714, 18px 12px 0 #ffd642, 24px 12px 0 #e2b714,
                6px 18px 0 #ffd642, 12px 18px 0 #e2b714, 18px 18px 0 #e2b714, 24px 18px 0 #e2b714, 30px 18px 0 #ffd642,
                0 24px 0 #4a90d9, 6px 24px 0 #3a7bc8, 12px 24px 0 #e2b714, 18px 24px 0 #e2b714, 24px 24px 0 #e2b714, 42px 24px 0 #ffffff,
                0 30px 0 #4a90d9, 6px 30px 0 #3a7bc8, 18px 30px 0 #e2b714, 42px 30px 0 #e0e0e0,
                12px 36px 0 #e2b714, 24px 36px 0 #e2b714,
                12px 42px 0 #8a6d0a, 24px 42px 0 #8a6d0a;
        }
        /* 法師 - 紫色身體, 青色法杖+火球 */
        .pixel-char-mage {
            width: 6px; height: 6px; background: transparent;
            box-shadow:
                18px 0 0 #c084fc,
                12px 6px 0 #c084fc, 18px 6px 0 #a855f7, 24px 6px 0 #c084fc,
                6px 12px 0 #c084fc, 12px 12px 0 #a855f7, 18px 12px 0 #a855f7, 24px 12px 0 #a855f7, 30px 12px 0 #c084fc,
                12px 18px 0 #a855f7, 18px 18px 0 #c084fc, 24px 18px 0 #a855f7,
                18px 24px 0 #a855f7, 42px 24px 0 #fbbf24,
                12px 30px 0 #a855f7, 18px 30px 0 #6b21a8, 24px 30px 0 #a855f7, 42px 30px 0 #22d3ee,
                12px 36px 0 #a855f7, 24px 36px 0 #a855f7, 42px 36px 0 #22d3ee,
                6px 42px 0 #6b21a8, 12px 42px 0 #a855f7, 24px 42px 0 #a855f7, 30px 42px 0 #6b21a8;
        }
        /* 遊俠 - 綠色身體, 棕木弓 */
        .pixel-char-ranger {
            width: 6px; height: 6px; background: transparent;
            box-shadow:
                12px 0 0 #86efac, 18px 0 0 #86efac, 24px 0 0 #86efac,
                6px 6px 0 #86efac, 12px 6px 0 #4ade80, 18px 6px 0 #4ade80, 24px 6px 0 #4ade80, 30px 6px 0 #86efac,
                12px 12px 0 #4ade80, 18px 12px 0 #86efac, 24px 12px 0 #4ade80,
                18px 18px 0 #4ade80, 36px 18px 0 #a0522d,
                12px 24px 0 #4ade80, 18px 24px 0 #4ade80, 24px 24px 0 #4ade80, 42px 24px 0 #cd853f,
                18px 30px 0 #4ade80, 36px 30px 0 #a0522d,
                12px 36px 0 #4ade80, 24px 36px 0 #4ade80,
                12px 42px 0 #16a34a, 24px 42px 0 #16a34a;
        }
        /* 刺客 - 紅色身體, 亮白雙匕首 */
        .pixel-char-assassin {
            width: 6px; height: 6px; background: transparent;
            box-shadow:
                12px 6px 0 #b91c1c, 18px 6px 0 #b91c1c, 24px 6px 0 #b91c1c,
                12px 12px 0 #ef4444, 18px 12px 0 #fca5a5, 24px 12px 0 #ef4444,
                0 18px 0 #ffffff, 12px 18px 0 #ef4444, 18px 18px 0 #ef4444, 24px 18px 0 #ef4444, 42px 18px 0 #ffffff,
                6px 24px 0 #e0e0e0, 18px 24px 0 #ef4444, 36px 24px 0 #e0e0e0,
                12px 30px 0 #ef4444, 18px 30px 0 #b91c1c, 24px 30px 0 #ef4444,
                12px 36px 0 #ef4444, 24px 36px 0 #ef4444,
                6px 42px 0 #b91c1c, 12px 42px 0 #b91c1c, 24px 42px 0 #b91c1c, 30px 42px 0 #b91c1c;
        }
        /* 待機動畫：微幅上下晃動 */
        @keyframes pixelIdle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-2px); }
        }
        .anim-idle { animation: pixelIdle 1.5s steps(2) infinite; }
    </style>
    <script>
        /* 防止 FOUC：等 Tailwind CDN 處理完再顯示頁面 */
        (function() {
            function reveal() { document.body.classList.add('page-ready'); }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() { requestAnimationFrame(reveal); });
            } else { requestAnimationFrame(reveal); }
            /* 安全閥：最多等 500ms，避免 CDN 問題導致永久白屏 */
            setTimeout(function() { if (document.body) document.body.classList.add('page-ready'); }, 500);
        })();

        /* 全域像素確認彈窗（取代 browser confirm） */
        window.pixelConfirm = function(msg) {
            return new Promise(resolve => {
                const overlay = document.createElement('div');
                overlay.className = 'fixed inset-0 z-[200] flex items-center justify-center bg-black/60';
                const card = document.createElement('div');
                card.className = 'pixel-card p-5 max-w-xs text-center';
                card.innerHTML = '<div class="text-xl mb-3">&#9888;</div>';
                const msgEl = document.createElement('div');
                msgEl.className = 'text-text-heading text-sm mb-4 leading-relaxed';
                msgEl.textContent = msg;
                card.appendChild(msgEl);
                const btnRow = document.createElement('div');
                btnRow.className = 'flex justify-center gap-2';
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'pixel-btn pixel-btn-purple text-xs py-1.5 px-4';
                cancelBtn.textContent = '\u53D6\u6D88';
                cancelBtn.onclick = () => { overlay.remove(); resolve(false); };
                const okBtn = document.createElement('button');
                okBtn.className = 'pixel-btn pixel-btn-gold text-xs py-1.5 px-4';
                okBtn.textContent = '\u78BA\u5B9A';
                okBtn.onclick = () => { overlay.remove(); resolve(true); };
                btnRow.appendChild(cancelBtn);
                btnRow.appendChild(okBtn);
                card.appendChild(btnRow);
                overlay.appendChild(card);
                overlay.addEventListener('click', (e) => { if (e.target === overlay) { overlay.remove(); resolve(false); } });
                document.body.appendChild(overlay);
                okBtn.focus();
            });
        };

        /* 全域像素輸入彈窗（取代 browser prompt） */
        window.pixelPrompt = function(msg, defaultVal) {
            return new Promise(resolve => {
                const overlay = document.createElement('div');
                overlay.className = 'fixed inset-0 z-[200] flex items-center justify-center bg-black/60';
                const card = document.createElement('div');
                card.className = 'pixel-card p-5 max-w-xs text-center';
                card.innerHTML = '<div class="text-xl mb-3">&#9998;</div>';
                const msgEl = document.createElement('div');
                msgEl.className = 'text-text-heading text-sm mb-3 leading-relaxed';
                msgEl.textContent = msg;
                card.appendChild(msgEl);
                const input = document.createElement('input');
                input.type = 'text';
                input.value = defaultVal || '';
                input.className = 'w-full px-2 py-1.5 bg-bg-input pixel-border-dark text-text-main text-sm focus:outline-none mb-4';
                card.appendChild(input);
                const btnRow = document.createElement('div');
                btnRow.className = 'flex justify-center gap-2';
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'pixel-btn pixel-btn-purple text-xs py-1.5 px-4';
                cancelBtn.textContent = '\u53D6\u6D88';
                cancelBtn.onclick = () => { overlay.remove(); resolve(null); };
                const okBtn = document.createElement('button');
                okBtn.className = 'pixel-btn pixel-btn-gold text-xs py-1.5 px-4';
                okBtn.textContent = '\u78BA\u5B9A';
                okBtn.onclick = () => { overlay.remove(); resolve(input.value || null); };
                btnRow.appendChild(cancelBtn);
                btnRow.appendChild(okBtn);
                card.appendChild(btnRow);
                overlay.appendChild(card);
                overlay.addEventListener('click', (e) => { if (e.target === overlay) { overlay.remove(); resolve(null); } });
                input.addEventListener('keydown', (e) => { if (e.key === 'Enter') { overlay.remove(); resolve(input.value || null); } });
                document.body.appendChild(overlay);
                input.focus();
            });
        };

        /* 全域 Toast 通知（像素風格） */
        window.toast = function(msg, type) {
            type = type || 'info';
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'fixed top-20 right-4 z-[100] flex flex-col gap-2 max-w-sm';
                document.body.appendChild(container);
            }
            const colors = {
                success: 'bg-positive/90 text-pixel-dark pixel-border',
                error: 'bg-negative/90 text-white pixel-border',
                info: 'bg-bg-card text-text-main pixel-border-dark'
            };
            const el = document.createElement('div');
            el.className = `px-4 py-3 text-sm shadow-lg toast-enter ${colors[type] || colors.info}`;
            el.textContent = msg;
            container.appendChild(el);
            setTimeout(() => { el.classList.add('toast-exit'); setTimeout(() => el.remove(), 300); }, 3000);
        };
    </script>
</head>
</html>
